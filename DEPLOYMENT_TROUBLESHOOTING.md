# 部署故障排除指南

## 常见问题

### 短链接生成失败 (405 Method Not Allowed)

**症状:**
```
生成短链接失败: Error: 短链接生成请求失败: 405
```

**原因:**
此错误通常出现在生产环境中，表示HTTP请求方法（POST）被拒绝。可能的原因包括：

1. 反向代理配置问题 - 某些代理服务器可能阻止或修改POST请求
2. 防火墙或WAF规则 - 安全规则可能阻止某些HTTP方法
3. 托管环境限制 - 某些托管服务可能限制API端点的HTTP方法

**解决方案:**
应用程序已更新，现在支持GET和POST两种方法来生成短链接。如果您仍然遇到此问题，请尝试以下步骤：

1. 确保`.env.local`文件中设置了正确的`NEXT_PUBLIC_SITE_URL`值：
   ```
   NEXT_PUBLIC_SITE_URL=https://your-actual-domain.com
   ```

2. 检查您的反向代理配置（如果使用），确保它允许POST请求通过到Next.js应用程序

3. 如果您使用CDN或API网关，检查它们的配置以允许必要的HTTP方法

4. 重新构建并部署应用程序以应用更改

### 数据存储权限问题

**症状:**
```
保存短链接数据失败
```

**原因:**
这通常是由于应用程序无法写入`data`目录引起的。

**解决方案:**
1. 确保`data`目录存在并且应用程序有写入权限
2. 在容器化环境中，确保volume正确挂载并持久化

## 环境变量检查表

部署前，请确保设置以下环境变量：

1. `NEXT_PUBLIC_SITE_URL` - 您的生产域名（包括协议）

## 日志收集

为了诊断生产问题，请收集以下日志：

1. 浏览器控制台日志（按F12打开开发者工具）
2. 服务器端日志（可在容器或托管平台日志中找到）

提交问题报告时，请包含详细的错误信息和上述日志。 